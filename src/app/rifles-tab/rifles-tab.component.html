<div class="space-y-3 text-xs">

  <!-- Add / Edit Rifle header -->
  <div class="bg-slate-800 rounded-2xl p-3 shadow flex items-center justify-between">
    <div class="text-sm font-semibold">
      {{ editingRifle ? 'Edit Rifle' : 'Add Rifle' }}
    </div>
    <button
      class="px-3 py-1 rounded-xl bg-slate-100 text-slate-900 text-xs font-semibold"
      (click)="toggleAddForm()">
      {{ addFormVisible ? 'Hide' : 'Show' }}
    </button>
  </div>

  <!-- Rifle form -->
  <div *ngIf="addFormVisible" class="bg-slate-800 rounded-2xl p-3 shadow space-y-2">
    <div class="grid grid-cols-2 gap-2">
      <label class="flex flex-col">
        Name
        <input
          [(ngModel)]="rifleForm.name"
          name="name"
          class="mt-1 px-2 py-1 rounded bg-slate-900 border border-slate-700" />
      </label>

      <label class="flex flex-col">
        Caliber
        <input
          [(ngModel)]="rifleForm.caliber"
          name="caliber"
          placeholder="33XC, 6.5 Creed, etc."
          class="mt-1 px-2 py-1 rounded bg-slate-900 border border-slate-700" />
      </label>

      <label class="flex flex-col">
        Barrel length
        <input
          type="number"
          [(ngModel)]="rifleForm.barrelLength"
          name="barrelLength"
          class="mt-1 px-2 py-1 rounded bg-slate-900 border border-slate-700" />
      </label>

      <label class="flex flex-col">
        Unit
        <select
          [(ngModel)]="rifleForm.barrelUnit"
          name="barrelUnit"
          class="mt-1 px-2 py-1 rounded bg-slate-900 border border-slate-700">
          <option value="cm">cm</option>
          <option value="inch">inch</option>
        </select>
      </label>

      <label class="flex flex-col">
        Twist
        <input
          [(ngModel)]="rifleForm.twistRate"
          name="twistRate"
          placeholder="1:8"
          class="mt-1 px-2 py-1 rounded bg-slate-900 border border-slate-700" />
      </label>

      <label class="flex flex-col">
        MV (fps)
        <input
          type="number"
          [(ngModel)]="rifleForm.muzzleVelocityFps"
          name="mv"
          class="mt-1 px-2 py-1 rounded bg-slate-900 border border-slate-700" />
      </label>

      <label class="flex flex-col">
        Scope unit
        <select
          [(ngModel)]="rifleForm.scopeUnit"
          name="scopeUnit"
          class="mt-1 px-2 py-1 rounded bg-slate-900 border border-slate-700">
          <option value="MIL">MIL</option>
          <option value="MOA">MOA</option>
        </select>
      </label>

      <label class="flex flex-col">
        Round count
        <input
          type="number"
          [(ngModel)]="rifleForm.roundCount"
          name="roundCount"
          placeholder="Total rounds fired so far"
          class="mt-1 px-2 py-1 rounded bg-slate-900 border border-slate-700" />
      </label>

      <label class="flex flex-col">
        BC (G7)
        <input
          [(ngModel)]="rifleForm.bulletBc"
          name="bc"
          class="mt-1 px-2 py-1 rounded bg-slate-900 border border-slate-700" />
      </label>

      <label class="flex flex-col">
        Bullet weight (gr)
        <input
          type="number"
          [(ngModel)]="rifleForm.bulletWeightGr"
          name="bulletWeight"
          class="mt-1 px-2 py-1 rounded bg-slate-900 border border-slate-700" />
      </label>

      <label class="flex flex-col">
        Bullet name / type
        <input
          [(ngModel)]="rifleForm.bulletName"
          name="bulletName"
          class="mt-1 px-2 py-1 rounded bg-slate-900 border border-slate-700" />
      </label>
    </div>

    <label class="flex flex-col">
      Notes
      <textarea
        [(ngModel)]="rifleForm.notes"
        name="notes"
        rows="2"
        class="mt-1 px-2 py-1 rounded bg-slate-900 border border-slate-700"></textarea>
    </label>

    <div class="flex justify-end gap-2 mt-2">
      <button
        class="px-3 py-1 text-xs rounded bg-slate-700"
        (click)="clearRifleForm()">
        Cancel
      </button>
      <button
        class="px-3 py-1 text-xs rounded bg-emerald-500 text-slate-900 font-semibold"
        (click)="saveRifle()">
        {{ editingRifle ? 'Save changes' : 'Add rifle' }}
      </button>
    </div>
  </div>

  <!-- Stored rifles -->
  <div class="bg-slate-800 rounded-2xl p-3 shadow space-y-2">
    <h2 class="text-sm font-semibold mb-1">
      Stored Rifles ({{ rifles.length }})
    </h2>

    <div *ngIf="rifles.length === 0" class="text-[11px] text-slate-400">
      No rifles saved yet. Use "Add Rifle" above.
    </div>

    <div
      *ngFor="let r of rifles"
      class="bg-slate-900 rounded-2xl p-3 mt-1 space-y-2">
      <div class="flex justify-between items-start">
        <div>
          <div class="text-sm font-semibold">
            {{ r.name }}
          </div>
          <div class="text-[11px] text-slate-300">
            {{ r.caliber }}
          </div>
        </div>

        <div class="flex gap-2 text-[11px]">
          <button
            class="px-2 py-1 rounded bg-slate-700"
            (click)="editRifle(r)">
            Edit
          </button>
          <button
            class="px-2 py-1 rounded bg-red-600"
            (click)="deleteRifle(r)">
            Delete
          </button>
        </div>
      </div>

      <div class="flex flex-wrap gap-2 mt-2 text-[10px]">
        <span class="px-2 py-[2px] rounded-full bg-slate-700">
          {{ r.caliber }}
        </span>
        <span *ngIf="r.muzzleVelocityFps != null" class="px-2 py-[2px] rounded-full bg-slate-700">
          {{ r.muzzleVelocityFps }} fps
        </span>
        <span *ngIf="r.bulletWeightGr != null" class="px-2 py-[2px] rounded-full bg-slate-700">
          {{ r.bulletWeightGr }} gr
        </span>
        <span *ngIf="r.roundCount != null" class="px-2 py-[2px] rounded-full bg-slate-700">
          {{ r.roundCount }} rounds
        </span>
        <span class="px-2 py-[2px] rounded-full bg-slate-700">
          {{ r.scopeUnit }}
        </span>
      </div>

      <!-- Load data section -->
      <div class="mt-3 space-y-1">
        <div class="flex justify-between items-center">
          <div class="text-[11px] font-semibold">Load data</div>
          <button
            class="px-2 py-1 text-[11px] rounded bg-slate-700"
            (click)="toggleLoads(r)">
            {{ activeLoadsRifleId === r.id ? 'Hide' : 'Show load' }}
          </button>
        </div>

        <div *ngIf="activeLoadsRifleId === r.id" class="space-y-2 mt-1">
          <div *ngIf="getLoadsForRifle(r).length === 0" class="text-[11px] text-slate-400">
            No loads for this rifle yet.
          </div>

          <div
            *ngFor="let load of getLoadsForRifle(r)"
            class="bg-slate-950 rounded-lg p-2 flex justify-between items-start text-[11px]">
            <div>
              <div>Powder: <strong>{{ load.powder }}</strong></div>
              <div>Charge: {{ load.chargeGn }} gn</div>
              <div *ngIf="load.coal">COAL: {{ load.coal }}</div>
              <div *ngIf="load.primer">Primer: {{ load.primer }}</div>
            </div>
            <div class="flex gap-1">
              <button
                class="px-2 py-1 rounded bg-slate-700"
                (click)="editLoad(r, load)">
                Edit
              </button>
              <button
                class="px-2 py-1 rounded bg-red-600"
                (click)="deleteLoad(r, load)">
                Delete
              </button>
            </div>
          </div>

          <!-- Add / edit load form -->
          <div class="bg-slate-950 rounded-lg p-2 space-y-1">
            <div class="flex justify-between items-center text-[11px]">
              <span>{{ editingLoadId ? 'Edit load' : 'Add load' }}</span>
            </div>

            <div class="grid grid-cols-2 gap-2 mt-1">
              <label class="flex flex-col">
                Powder
                <input
                  [(ngModel)]="loadForm.powder"
                  name="powder"
                  class="mt-1 px-2 py-1 rounded bg-slate-900 border border-slate-700" />
              </label>

              <label class="flex flex-col">
                Charge (gn)
                <input
                  type="number"
                  [(ngModel)]="loadForm.chargeGn"
                  name="chargeGn"
                  class="mt-1 px-2 py-1 rounded bg-slate-900 border border-slate-700" />
              </label>

              <label class="flex flex-col">
                COAL
                <input
                  [(ngModel)]="loadForm.coal"
                  name="coal"
                  class="mt-1 px-2 py-1 rounded bg-slate-900 border border-slate-700" />
              </label>

              <label class="flex flex-col">
                Primer
                <input
                  [(ngModel)]="loadForm.primer"
                  name="primer"
                  class="mt-1 px-2 py-1 rounded bg-slate-900 border border-slate-700" />
              </label>
            </div>

            <div class="flex justify-end gap-2 mt-2">
              <button
                class="px-3 py-1 text-[11px] rounded bg-slate-700"
                (click)="resetLoadForm()">
                Clear
              </button>
              <button
                class="px-3 py-1 text-[11px] rounded bg-emerald-500 text-slate-900"
                (click)="saveLoad(r)">
                {{ editingLoadId ? 'Save load' : 'Add load' }}
              </button>
            </div>
          </div>
        </div>
      </div>

      <div *ngIf="r.notes" class="mt-2 text-[11px] text-slate-300">
        Notes: {{ r.notes }}
      </div>
    </div>
  </div>
</div>
